#!/usr/bin/env node
import*as O from"fs";import*as m from"path";import*as l from"url";import{transformSync as _}from"esbuild";let h;function R(r){h=r}async function y(r,e,s){if(!(r.startsWith(".")||r.startsWith("/"))&&h){const{baseUrl:t,paths:a,tsconfigDir:u}=h;for(const i of Object.keys(a)){let o=null;if(i.endsWith("/*")){const c=i.slice(0,-2);if(r.startsWith(c)){const n=r.slice(c.length);(n===""||n.startsWith("/"))&&(o=n,o.startsWith("/")&&(o=o.slice(1)))}}else r===i&&(o="");if(o!==null)for(const c of a[i]){const n=c.replace(/\*/g,o),g=t??u;if(g){const U=l.pathToFileURL(m.join(g,"dummy.ts")).href;try{return{...await y(`./${n}`,{parentURL:U},s),shortCircuit:!0}}catch(f){if(f.code!=="ERR_MODULE_NOT_FOUND")throw f}}}}if(t){const i=l.pathToFileURL(m.join(t,"dummy.ts")).href;try{return{...await y(`./${r}`,{parentURL:i},s),shortCircuit:!0}}catch(o){if(o.code!=="ERR_MODULE_NOT_FOUND")throw o}}}try{return{...await s(r,e),shortCircuit:!0}}catch(t){if(t.code!=="ERR_MODULE_NOT_FOUND")throw t}try{return{...await s(r+".ts",e),shortCircuit:!0}}catch(t){if(t.code!=="ERR_MODULE_NOT_FOUND")throw t}try{return{...await s(r+".tsx",e),shortCircuit:!0}}catch(t){if(t.code!=="ERR_MODULE_NOT_FOUND")throw t}try{return{...await s(r+"/index.ts",e),shortCircuit:!0}}catch(t){if(t.code!=="ERR_MODULE_NOT_FOUND")throw t}try{return{...await s(r+"/index.tsx",e),shortCircuit:!0}}catch(t){throw t}}async function v(r,e,s){if(!r.endsWith(".ts")&&!r.endsWith(".tsx"))return s(r,e);const d=r.endsWith(".tsx")?"tsx":"ts",t=l.fileURLToPath(r),a=O.readFileSync(t,"utf8"),{code:u}=_(a,{loader:d,format:"esm",target:`node${process.versions.node}`,sourcemap:"inline",sourcefile:t});return{format:"module",source:u,shortCircuit:!0}}export{R as initialize,v as load,y as resolve};
